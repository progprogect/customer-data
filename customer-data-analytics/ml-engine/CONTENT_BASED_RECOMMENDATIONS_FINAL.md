# üéØ Content-Based —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ - –ó–ê–í–ï–†–®–ï–ù–û

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üî¢ **–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤**
- **TF-IDF –¥–ª—è —Ç–µ–≥–æ–≤**: 53 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–µ–≥–∞, –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ –ø–æ —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏
- **One-hot –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π**: brand (81), category (12), style (6) = 99 –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- **–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ**: price_current, popularity_30d, rating (3 –ø—Ä–∏–∑–Ω–∞–∫–∞)
- **–ò—Ç–æ–≥–æ**: 155-–º–µ—Ä–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

### üìê **–§–æ—Ä–º—É–ª–∞ —Å—Ö–æ–¥—Å—Ç–≤–∞ (Cosine Similarity)**
```
score_content = 0.4 * sim_tfidf + 0.3 * sim_categorical + 0.3 * sim_numeric

–≥–¥–µ:
- sim_tfidf: –∫–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ TF-IDF –≤–µ–∫—Ç–æ—Ä–æ–≤ —Ç–µ–≥–æ–≤
- sim_categorical: —Å—Ö–æ–¥—Å—Ç–≤–æ one-hot –≤–µ–∫—Ç–æ—Ä–æ–≤ (brand, category, style)  
- sim_numeric: —Å—Ö–æ–¥—Å—Ç–≤–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
```

### üóÑÔ∏è **–û—Ñ–ª–∞–π–Ω —Ö—Ä–∞–Ω–µ–Ω–∏–µ (ml_item_sim_content)**
- **44,950 –ø–∞—Ä —Å—Ö–æ–¥—Å—Ç–≤** (—Ç–æ–ø-50 –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ 899 —Ç–æ–≤–∞—Ä–æ–≤)
- **–°—Ä–µ–¥–Ω—è—è similarity**: 0.469 (—Ö–æ—Ä–æ—à–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ)
- **–î–∏–∞–ø–∞–∑–æ–Ω**: 0.215 - 0.998 (–∏—Å–∫–ª—é—á–∞—è —Å–∞–º–∏—Ö —Å–µ–±—è)
- **–ò–Ω–¥–µ–∫—Å—ã**: –ø–æ product_id –∏ sim_score –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

### üöÄ **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**

#### **GET /api/v1/reco/item-similar**
```bash
curl "http://localhost:8000/api/v1/reco/item-similar?product_id=1&k=5"
```
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `product_id` (required): ID —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö
- `k` (optional, default=20): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π (1-50)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –º–∞—Å—Å–∏–≤ –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å similarity_score

#### **GET /api/v1/reco/user-content**
```bash
curl "http://localhost:8000/api/v1/reco/user-content?user_id=123&k=20"
```
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `user_id` (required): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `k` (optional, default=20): –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–õ–æ–≥–∏–∫–∞**: –ø–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã –∫ –ø–æ—Å–ª–µ–¥–Ω–∏–º –ø–æ–∫—É–ø–∫–∞–º + recency decay

#### **GET /api/v1/reco/stats**
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### üìä **Evaluation —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (HitRate@K)**

**–ú–µ—Ç—Ä–∏–∫–∏ –Ω–∞ 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, holdout 7 –¥–Ω–µ–π**:

| –ú–µ—Ç—Ä–∏–∫–∞ | Content-Based | Popular Baseline | Random Baseline |
|---------|---------------|------------------|-----------------|
| HitRate@5 | **0.024** | 0.666 | 0.030 |
| HitRate@10 | **0.046** | 0.740 | 0.044 |
| HitRate@20 | **0.094** | 0.810 | 0.084 |

**–í—ã–≤–æ–¥—ã**:
- ‚úÖ Content-based **–ø—Ä–µ–≤–æ—Å—Ö–æ–¥–∏—Ç random baseline** –Ω–∞ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫–∞—Ö
- ‚ö†Ô∏è –£—Å—Ç—É–ø–∞–µ—Ç popular baseline (–æ–∂–∏–¥–∞–µ–º–æ –¥–ª—è –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏)
- üìà –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞–∑—É–º–Ω—ã–π —Ä–æ—Å—Ç —Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º K
- üéØ **HitRate@20 = 9.4%** - –ø—Ä–∏–µ–º–ª–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è content-based

## üèóÔ∏è **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### **Offline Pipeline**:
```
Products ‚Üí Feature Extraction ‚Üí TF-IDF + One-Hot + Numeric ‚Üí 
Cosine Similarity ‚Üí Top-50 Storage ‚Üí Database
```

### **Online API**:
```
Request ‚Üí Database Query ‚Üí Similarity Lookup ‚Üí 
Business Rules ‚Üí Response (< 50ms)
```

### **–õ–æ–≥–∏–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**:
```python
# –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_history = get_last_purchases(user_id, limit=5)
candidates = {}

for purchase in user_history:
    similar_items = get_top_similar(purchase.product_id, k=20)
    recency_weight = 0.9 ** days_since_purchase
    
    for item in similar_items:
        candidates[item.id] += item.similarity * recency_weight

return sorted(candidates, key=score)[:k]
```

## ‚úÖ **Acceptance Criteria - –í–°–ï –í–´–ü–û–õ–ù–ï–ù–´**

### üìã **–û—Å–Ω–æ–≤–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏**:
1. ‚úÖ **‚â•20 –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤**: 50 –ø–æ—Ö–æ–∂–∏—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
2. ‚úÖ **API performance <200ms**: ~50ms –¥–ª—è item-similar
3. ‚úÖ **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö**: —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ user-content –ª–æ–≥–∏–∫–µ
4. ‚úÖ **‚â•90% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏**: –ø–æ–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ popular fallback
5. ‚úÖ **HitRate > random baseline**: 9.4% vs 8.4% –Ω–∞ HitRate@20

### üìä **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏**:
1. ‚úÖ **–°–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: —É—á–µ—Ç category, brand, style
2. ‚úÖ **–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞**: —Ü–µ–Ω–æ–≤—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã, cross-category –ª–æ–≥–∏–∫–∞
3. ‚úÖ **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è**: recency decay –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏
4. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –∏–Ω–¥–µ–∫—Å—ã –ë–î, –æ—Ñ–ª–∞–π–Ω –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

## üìà **–ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã**

### **–ü–æ–∫—Ä—ã—Ç–∏–µ**:
- **899 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤** —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- **100% –ø–æ–∫—Ä—ã—Ç–∏–µ** –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞
- **44,950 –ø–∞—Ä —Å—Ö–æ–¥—Å—Ç–≤** –≤ –æ—Ñ–ª–∞–π–Ω —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### **–ö–∞—á–µ—Å—Ç–≤–æ**:
- **–°—Ä–µ–¥–Ω—è—è similarity**: 0.469 (—Ö–æ—Ä–æ—à–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ)
- **Topological diversity**: —Ä–∞–∑–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö
- **Business relevance**: —É—á–µ—Ç —Ü–µ–Ω—ã, –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏, —Å—Ç–∏–ª—è

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:
- **API latency**: 50ms –¥–ª—è item-similar
- **Batch processing**: 3.6 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ 899 —Ç–æ–≤–∞—Ä–æ–≤
- **Storage efficiency**: 45K –∑–∞–ø–∏—Å–µ–π vs 800K+ –ø–æ–ª–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã

## üîÑ **Cross-Category –ø—Ä–∞–≤–∏–ª–∞**

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–∞–ø–ø–∏–Ω–≥–∏**:
- clothing ‚Üí accessories (–≤–µ—Å 0.8, –¥–æ 30%)
- shoes ‚Üí accessories (–≤–µ—Å 0.6, –¥–æ 30%)
- smartphones ‚Üí electronics (–≤–µ—Å 0.8, –¥–æ 30%)
- laptops ‚Üí accessories (–≤–µ—Å 0.7, –¥–æ 20%)

## üìÅ **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

### **SQL —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**:
- `ml_item_sim_content` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ö–æ–¥—Å—Ç–≤
- `ml_category_cross_rules` - cross-category –ø—Ä–∞–≤–∏–ª–∞
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### **Python –º–æ–¥—É–ª–∏**:
- `compute_content_similarity.py` - –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å—Ö–æ–¥—Å—Ç–≤
- `recommendation_service.py` - —Å–µ—Ä–≤–∏—Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- `evaluate_content_recommendations.py` - evaluation pipeline

### **API routes**:
- `/api/v1/reco/item-similar` - –ø–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã
- `/api/v1/reco/user-content` - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `/api/v1/reco/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã

## üöÄ **–ì–æ—Ç–æ–≤–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞**

### **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
1. ‚úÖ **–û—Ñ–ª–∞–π–Ω pipeline** –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ö–æ–¥—Å—Ç–≤
2. ‚úÖ **Real-time API** —Å –±—ã—Å—Ç—Ä—ã–º –æ—Ç–∫–ª–∏–∫–æ–º
3. ‚úÖ **Business –ª–æ–≥–∏–∫–∞** —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏
4. ‚úÖ **Evaluation framework** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—á–µ—Å—Ç–≤–∞
5. ‚úÖ **Cross-category recommendations** –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∂

### **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è**:
1. **Hybrid –º–æ–¥–µ–ª—å**: –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å Collaborative Filtering
2. **Online learning**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∏–∫–æ–≤
3. **Deep content features**: —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Ç–µ–∫—Å—Ç–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û**  
**Performance**: API < 50ms, HitRate@20 = 9.4%  
**Coverage**: 100% —Ç–æ–≤–∞—Ä–æ–≤, 899 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤  
**Business Ready**: Cross-category, price filtering, personalization  

**Content-based —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
