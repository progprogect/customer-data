# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è Churn Prediction

## ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

### **–ü—Ä–æ–±–ª–µ–º–∞:**
–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–∫–∞–∑—ã–≤–∞–ª "–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Ä–∏—Å–∫–æ–º –æ—Ç—Ç–æ–∫–∞ –≤—ã—à–µ 10%", —Ö–æ—Ç—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –æ—Ç—Ç–æ–∫—É –∫–ª–∏–µ–Ω—Ç–æ–≤ (25.7% –æ–±—â–∏–π churn rate).

### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
1. ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å - 25,938 –∑–∞–ø–∏—Å–µ–π, 6,665 –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –æ—Ç—Ç–æ–∫–æ–º (25.7%)
2. ‚ùå **API**: –í–æ–∑–≤—Ä–∞—â–∞–ª –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`
3. ‚ùå **ML –º–æ–¥–µ–ª—å**: –ù–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å –∫ –¥–∞–Ω–Ω—ã–º –∏–∑ –ë–î

---

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### **1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `churn_service.py`:**
- ‚ùå **–ë—ã–ª–æ**: –ú–µ—Ç–æ–¥ `get_high_risk_users` –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ñ–∏—á–∞–º–∏
- ‚úÖ **–°—Ç–∞–ª–æ**: –ü—Ä–∏–º–µ–Ω—è–µ—Ç ML –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Ä–∏—Å–∫–∞ –æ—Ç—Ç–æ–∫–∞

### **2. –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö:**
- ‚ùå **–ë—ã–ª–æ**: XGBoost –ø–æ–ª—É—á–∞–ª –¥–∞–Ω–Ω—ã–µ —Ç–∏–ø–∞ `object` (—Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **–°—Ç–∞–ª–æ**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ `float` –∏ `int`

### **3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ —Ä–æ—É—Ç–µ:**
- ‚ùå **–ë—ã–ª–æ**: ML –º–æ–¥–µ–ª—å –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å –¥–≤–∞–∂–¥—ã
- ‚úÖ **–°—Ç–∞–ª–æ**: –û–¥–∏–Ω —Ä–∞–∑ –≤ `churn_service`, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ä–æ—É—Ç

---

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **1. –û–±–Ω–æ–≤–ª–µ–Ω `churn_service.py`:**

```python
def get_high_risk_users(self, limit: int = 20, threshold: float = 0.6, snapshot_date: str = None):
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ñ–∏—á–∞–º–∏ –∏–∑ –ë–î
    # –ü—Ä–∏–º–µ–Ω—è–µ–º ML –º–æ–¥–µ–ª—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    # –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –ø–æ—Ä–æ–≥—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–∏—Å–∫–∞
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ø-N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

### **2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**

```python
user_features = {
    'recency_days': float(row[2]) if row[2] is not None else 999.0,
    'frequency_90d': int(row[3]) if row[3] is not None else 0,
    'monetary_180d': float(row[4]) if row[4] is not None else 0.0,
    'aov_180d': float(row[5]) if row[5] is not None else 0.0,
    'orders_lifetime': int(row[6]) if row[6] is not None else 0,
    'revenue_lifetime': float(row[7]) if row[7] is not None else 0.0,
    'categories_unique': int(row[8]) if row[8] is not None else 0
}
```

### **3. –£–ø—Ä–æ—â–µ–Ω —Ä–æ—É—Ç `churn_analytics.py`:**

```python
# –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º (—É–∂–µ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–π ML –º–æ–¥–µ–ª—å—é)
high_risk_users_data = churn_service.get_high_risk_users(limit=limit, threshold=threshold, snapshot_date=snapshot_date)

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç API
# –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **API —Ç–µ—Å—Ç—ã:**

```bash
# –ü–æ—Ä–æ–≥ 30% - –Ω–∞—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
curl "http://localhost:8000/api/v1/churn/high-risk-users?snapshot_date=2025-07-14&limit=5&churn_threshold=0.3"
# ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 4 –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ä–∏—Å–∫–æ–º 60-87%

# –ü–æ—Ä–æ–≥ 70% - –Ω–∞—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º  
curl "http://localhost:8000/api/v1/churn/high-risk-users?snapshot_date=2025-07-14&limit=5&churn_threshold=0.7"
# ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 3 –∫–ª–∏–µ–Ω—Ç–∞ —Å —Ä–∏—Å–∫–æ–º 70-87%
```

### **–ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:**

```json
{
  "user_id": 1,
  "prob_churn": 0.875,
  "reasons": ["–≤—ã—Å–æ–∫–∏–π –æ–±—â–∏–π —Ä–∏—Å–∫ –æ—Ç—Ç–æ–∫–∞"]
}
{
  "user_id": 16, 
  "prob_churn": 0.814,
  "reasons": ["–≤—ã—Å–æ–∫–∏–π –æ–±—â–∏–π —Ä–∏—Å–∫ –æ—Ç—Ç–æ–∫–∞"]
}
{
  "user_id": 14,
  "prob_churn": 0.705,
  "reasons": ["–≤—ã—Å–æ–∫–∏–π –æ–±—â–∏–π —Ä–∏—Å–∫ –æ—Ç—Ç–æ–∫–∞"]
}
```

---

## üéØ –ò—Ç–æ–≥

**‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!**

- **API —Ä–∞–±–æ—Ç–∞–µ—Ç**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º –æ—Ç—Ç–æ–∫–∞
- **ML –º–æ–¥–µ–ª—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç—Ç–æ–∫–∞
- **–î–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω—ã–µ**: –ò–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –º–æ–∫–æ–≤—ã–µ
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ü–æ –ø–æ—Ä–æ–≥—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –æ—Ç—Ç–æ–∫–∞
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ü–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–∏—Å–∫–∞

### **–ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–∏–π churn rate 25.7%
2. **–°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å —Ä–∏—Å–∫–æ–º –≤—ã—à–µ –ø–æ—Ä–æ–≥–∞
3. **–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏**: –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è ML –º–æ–¥–µ–ª–∏ (60-87%)
4. **–ü—Ä–∏—á–∏–Ω—ã**: –û–±—ä—è—Å–Ω–µ–Ω–∏—è —Ä–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ feature importance

–§—Ä–æ–Ω—Ç–µ–Ω–¥ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤—ã—Å–æ–∫–∏–º —Ä–∏—Å–∫–æ–º –æ—Ç—Ç–æ–∫–∞ –≤–º–µ—Å—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è "–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤"!
