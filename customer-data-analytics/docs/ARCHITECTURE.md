# Архитектура системы

## Обзор

Customer Data Analytics - это система аналитики и персонализированных рекомендаций, построенная на микросервисной архитектуре с четким разделением ответственности между компонентами.

## Компоненты системы

### 1. ML Engine (Python)
**Назначение**: Машинное обучение и аналитика

**Технологии**:
- Python 3.8+
- scikit-learn, pandas, numpy
- SQLAlchemy для работы с БД

**Модули**:
- `models/` - ML модели (сегментация, рекомендации, churn prediction)
- `data/` - обработка данных
- `training/` - скрипты обучения
- `utils/` - утилиты

**Основные функции**:
- Сегментация пользователей (K-means, DBSCAN)
- Рекомендательная система (Collaborative + Content-based)
- Предсказание оттока клиентов
- Анализ ценовой эластичности
- Детекция аномалий

### 2. API Gateway (FastAPI)
**Назначение**: REST API для всех компонентов

**Технологии**:
- FastAPI
- Pydantic для валидации
- SQLAlchemy для БД
- Uvicorn как ASGI сервер

**Модули**:
- `routes/` - API эндпоинты
- `models/` - Pydantic модели
- `services/` - бизнес-логика
- `middleware/` - промежуточное ПО

**API группы**:
- `/api/v1/analytics` - аналитика
- `/api/v1/recommendations` - рекомендации
- `/api/v1/users` - пользователи
- `/api/v1/products` - товары

### 3. Frontend (React)
**Назначение**: Веб-интерфейс для дашборда

**Технологии**:
- React 18
- TypeScript
- Axios для API
- Recharts для графиков

**Модули**:
- `components/` - React компоненты
- `services/` - API сервисы
- `utils/` - утилиты
- `styles/` - стили

**Основные компоненты**:
- Dashboard - главный дашборд
- MetricsCard - карточки метрик
- Chart - графики
- UserSegmentation - сегментация
- Recommendations - рекомендации

### 4. Telegram Bot (Python)
**Назначение**: Telegram интерфейс

**Технологии**:
- python-telegram-bot
- httpx для API запросов
- asyncio для асинхронности

**Модули**:
- `handlers/` - обработчики команд
- `utils/` - утилиты
- `keyboards/` - клавиатуры

**Функции**:
- Интерактивные меню
- Callback обработчики
- Интеграция с API
- Удобная навигация

### 5. Shared Components
**Назначение**: Общие компоненты

**Модули**:
- `database/` - подключение к БД
- `utils/` - общие утилиты
- `types/` - общие типы данных

## Потоки данных

### 1. Сбор данных
```
Пользователи → События → База данных
```

### 2. Обработка данных
```
База данных → ML Engine → Модели → API
```

### 3. Отображение данных
```
API → Frontend/Telegram Bot → Пользователи
```

## Интеграции

### Внутренние
- ML Engine ↔ API (импорт моделей)
- API ↔ Frontend (REST API)
- API ↔ Telegram Bot (REST API)
- Все компоненты ↔ Shared (общие утилиты)

### Внешние
- PostgreSQL (основная БД)
- Redis (кеширование, опционально)
- Telegram API (бот)

## Безопасность

### Аутентификация
- Пока не реализована (тестовая среда)
- Планируется JWT токены

### Валидация данных
- Pydantic модели для API
- TypeScript типы для фронтенда
- Валидация на уровне БД

### Логирование
- Структурированные логи
- Ротация логов
- Мониторинг ошибок

## Масштабируемость

### Горизонтальное масштабирование
- API серверы за load balancer
- ML Engine на отдельных серверах
- Frontend на CDN

### Вертикальное масштабирование
- Увеличение ресурсов серверов
- Оптимизация запросов к БД
- Кеширование результатов

### Оптимизация производительности
- Индексы в БД
- Кеширование API ответов
- Lazy loading в фронтенде
- Асинхронная обработка

## Мониторинг

### Метрики
- Производительность API
- Использование ML моделей
- Активность пользователей
- Ошибки системы

### Логирование
- Структурированные логи
- Централизованный сбор
- Алерты на критические ошибки

### Health checks
- API endpoints
- Database connectivity
- ML model status
- External services

## Развертывание

### Development
- Локальная разработка
- Hot reload для фронтенда
- Debug режим для API

### Production
- Docker контейнеры
- Kubernetes оркестрация
- CI/CD pipeline
- Blue-green deployment

## Будущие улучшения

### Планируемые функции
- Аутентификация и авторизация
- Real-time уведомления
- Расширенная аналитика
- A/B тестирование
- Микросервисная архитектура

### Технические улучшения
- GraphQL API
- WebSocket для real-time
- Message queues
- Event sourcing
- CQRS pattern

